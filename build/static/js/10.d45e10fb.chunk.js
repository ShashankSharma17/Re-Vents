(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{809:function(e,t,n){"use strict";n.d(t,"c",function(){return a}),n.d(t,"b",function(){return o}),n.d(t,"a",function(){return s});var r=n(162),a=function(){return{type:r.c}},o=function(){return{type:r.b}},s=function(){return{type:r.a}}},814:function(e,t,n){"use strict";n.d(t,"c",function(){return c}),n.d(t,"b",function(){return i}),n.d(t,"a",function(){return u});var r=n(26),a=n(47),o=n(808),s=n.n(o),c=function(e){if(e)return Object.entries(e).map(function(e){return Object.assign(e[1],{id:e[0]})})},i=function(e,t,n){return n.date=s()(n.date).toDate(),Object(a.a)({},n,{hostUid:e.uid,hostedBy:e.displayName,hostPhotoURL:t||"/assets/user.png",created:Date.now(),attendees:Object(r.a)({},e.uid,{going:!0,joinDate:Date.now(),photoURL:t||"/assets/user.png",displayName:e.displayName,host:!0})})},u=function(e){var t=Object.create(null);e.forEach(function(e){return t[e.id]=Object(a.a)({},e,{childNodes:[]})});var n=[];return e.forEach(function(e){e.parentId?t[e.parentId].childNodes.push(t[e.id]):n.push(t[e.id])}),n}},819:function(e,t,n){"use strict";n.d(t,"c",function(){return m}),n.d(t,"e",function(){return b}),n.d(t,"b",function(){return y}),n.d(t,"d",function(){return E}),n.d(t,"a",function(){return g});var r=n(47),a=n(806),o=n.n(a),s=n(807),c=n(808),i=n.n(c),u=n(159),l=n(814),d=n(219),p=n(809),f=n(131),h=n(815),v=n.n(h),m=function(e){return function(){var t=Object(s.a)(o.a.mark(function t(n,r,a){var s,c,i,d,p,f;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=a.getFirestore,c=s(),i=c.auth().currentUser,d=r().firebase.profile.photoURL,p=Object(l.b)(i,d,e),t.prev=5,t.next=8,c.add("events",p);case 8:return f=t.sent,t.next=11,c.set("event_attendee/".concat(f.id,"_").concat(i.uid),{eventId:f.id,userUid:i.uid,eventDate:e.date,host:!0});case 11:u.toastr.success("Success!","Event has been created"),t.next=17;break;case 14:t.prev=14,t.t0=t.catch(5),u.toastr.error("Oops","Something went wrong");case 17:case"end":return t.stop()}},t,null,[[5,14]])}));return function(e,n,r){return t.apply(this,arguments)}}()},b=function(e){return function(){var t=Object(s.a)(o.a.mark(function t(n,r){var a,s,c,l,f,h,m,b;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(n(Object(p.c)()),a=d.a.firestore(),e.date=i()(e.date).toDate(),t.prev=3,s=a.collection("events").doc(e.id),0===v()(r().firestore.ordered.events[0].date,e.date)){t.next=31;break}return c=a.batch(),t.next=10,c.update(s,e);case 10:return l=a.collection("event_attendee"),t.next=13,l.where("eventId","==",e.id);case 13:return f=t.sent,t.next=16,f.get();case 16:h=t.sent,m=0;case 18:if(!(m<h.docs.length)){t.next=27;break}return t.next=21,a.collection("event_attendee").doc(h.docs[m].id);case 21:return b=t.sent,t.next=24,c.update(b,{eventDate:e.date});case 24:m++,t.next=18;break;case 27:return t.next=29,c.commit();case 29:t.next=33;break;case 31:return t.next=33,s.update(e);case 33:n(Object(p.b)()),u.toastr.success("Success!","Event has been updated"),t.next=41;break;case 37:t.prev=37,t.t0=t.catch(3),n(Object(p.a)()),u.toastr.error("Oops","Something went wrong");case 41:case"end":return t.stop()}},t,null,[[3,37]])}));return function(e,n){return t.apply(this,arguments)}}()},y=function(e,t){return function(){var n=Object(s.a)(o.a.mark(function n(r,a,s){var c,i,l;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:c=s.getFirestore,i=c(),l=e?"Are you sure you want to cancel the event?":"This will reactivate the event - are you sure?\xcc";try{u.toastr.confirm(l,{onOk:function(){return i.update("events/".concat(t),{cancelled:e})}})}catch(r){console.log(r)}case 4:case"end":return n.stop()}},n)}));return function(e,t,r){return n.apply(this,arguments)}}()},E=function(e){return function(){var t=Object(s.a)(o.a.mark(function t(n,a){var s,c,i,u,l,h,v,m,b;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=new Date(Date.now()),c=d.a.firestore(),i=c.collection("events"),t.prev=3,n(Object(p.c)()),t.t0=e,!t.t0){t.next=10;break}return t.next=9,c.collection("events").doc(e.id).get();case 9:t.t0=t.sent;case 10:return u=t.t0,l=e?i.where("date",">=",s).orderBy("date").startAfter(u).limit(2):i.where("date",">=",s).orderBy("date").limit(2),t.next=14,l.get();case 14:if(0!==(h=t.sent).docs.length){t.next=18;break}return n(Object(p.b)()),t.abrupt("return",h);case 18:for(v=[],m=0;m<h.docs.length;m++)b=Object(r.a)({},h.docs[m].data(),{id:h.docs[m].id}),v.push(b);return n({type:f.c,payload:{events:v}}),n(Object(p.b)()),t.abrupt("return",h);case 25:t.prev=25,t.t1=t.catch(3),console.log(t.t1),n(Object(p.a)());case 29:case"end":return t.stop()}},t,null,[[3,25]])}));return function(e,n){return t.apply(this,arguments)}}()},g=function(e,t,n){return function(){var r=Object(s.a)(o.a.mark(function r(a,s,c){var i,l,d,p,f;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return i=c.getFirebase,l=i(),d=s().firebase.profile,p=l.auth().currentUser,f={parentId:n,displayName:d.displayName,photoURL:d.photoURL,uid:p.uid,text:t.comment,date:Date.now()},r.prev=5,r.next=8,l.push("event_chat/".concat(e),f);case 8:r.next=14;break;case 10:r.prev=10,r.t0=r.catch(5),console.log(r.t0),u.toastr.error("Oops","Problem adding comment");case 14:case"end":return r.stop()}},r,null,[[5,10]])}));return function(e,t,n){return r.apply(this,arguments)}}()}},865:function(e,t,n){var r=n(866),a=n(803),o=n(867),s=n(869),c=n(864),i=1440,u=2520,l=43200,d=86400;e.exports=function(e,t,n){var p=n||{},f=r(e,t),h=p.locale,v=c.distanceInWords.localize;h&&h.distanceInWords&&h.distanceInWords.localize&&(v=h.distanceInWords.localize);var m,b,y={addSuffix:Boolean(p.addSuffix),comparison:f};f>0?(m=a(e),b=a(t)):(m=a(t),b=a(e));var E,g=o(b,m),w=b.getTimezoneOffset()-m.getTimezoneOffset(),O=Math.round(g/60)-w;if(O<2)return p.includeSeconds?g<5?v("lessThanXSeconds",5,y):g<10?v("lessThanXSeconds",10,y):g<20?v("lessThanXSeconds",20,y):g<40?v("halfAMinute",null,y):v(g<60?"lessThanXMinutes":"xMinutes",1,y):0===O?v("lessThanXMinutes",1,y):v("xMinutes",O,y);if(O<45)return v("xMinutes",O,y);if(O<90)return v("aboutXHours",1,y);if(O<i)return v("aboutXHours",Math.round(O/60),y);if(O<u)return v("xDays",1,y);if(O<l)return v("xDays",Math.round(O/i),y);if(O<d)return v("aboutXMonths",E=Math.round(O/l),y);if((E=s(b,m))<12)return v("xMonths",Math.round(O/l),y);var j=E%12,x=Math.floor(E/12);return j<3?v("aboutXYears",x,y):j<9?v("overXYears",x,y):v("almostXYears",x+1,y)}},866:function(e,t,n){var r=n(803);e.exports=function(e,t){var n=r(e).getTime(),a=r(t).getTime();return n>a?-1:n<a?1:0}},867:function(e,t,n){var r=n(868);e.exports=function(e,t){var n=r(e,t)/1e3;return n>0?Math.floor(n):Math.ceil(n)}},868:function(e,t,n){var r=n(803);e.exports=function(e,t){var n=r(e),a=r(t);return n.getTime()-a.getTime()}},869:function(e,t,n){var r=n(803),a=n(870),o=n(815);e.exports=function(e,t){var n=r(e),s=r(t),c=o(n,s),i=Math.abs(a(n,s));return n.setMonth(n.getMonth()-c*i),c*(i-(o(n,s)===-c))}},870:function(e,t,n){var r=n(803);e.exports=function(e,t){var n=r(e),a=r(t);return 12*(n.getFullYear()-a.getFullYear())+(n.getMonth()-a.getMonth())}},918:function(e,t,n){e.exports=n(919)},919:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),o=c(a),s=c(n(2));function c(e){return e&&e.__esModule?e:{default:e}}var i=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.scrollListener=n.scrollListener.bind(n),n}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),r(t,[{key:"componentDidMount",value:function(){this.pageLoaded=this.props.pageStart,this.attachScrollListener()}},{key:"componentDidUpdate",value:function(){this.attachScrollListener()}},{key:"componentWillUnmount",value:function(){this.detachScrollListener(),this.detachMousewheelListener()}},{key:"setDefaultLoader",value:function(e){this.defaultLoader=e}},{key:"detachMousewheelListener",value:function(){var e=window;!1===this.props.useWindow&&(e=this.scrollComponent.parentNode),e.removeEventListener("mousewheel",this.mousewheelListener,this.props.useCapture)}},{key:"detachScrollListener",value:function(){var e=window;!1===this.props.useWindow&&(e=this.scrollComponent.parentNode),e.removeEventListener("scroll",this.scrollListener,this.props.useCapture),e.removeEventListener("resize",this.scrollListener,this.props.useCapture)}},{key:"attachScrollListener",value:function(){if(this.props.hasMore){var e=window;!1===this.props.useWindow&&(e=this.scrollComponent.parentNode),e.addEventListener("mousewheel",this.mousewheelListener,this.props.useCapture),e.addEventListener("scroll",this.scrollListener,this.props.useCapture),e.addEventListener("resize",this.scrollListener,this.props.useCapture),this.props.initialLoad&&this.scrollListener()}}},{key:"mousewheelListener",value:function(e){1===e.deltaY&&e.preventDefault()}},{key:"scrollListener",value:function(){var e=this.scrollComponent,t=window,n=void 0;if(this.props.useWindow){var r=document.documentElement||document.body.parentNode||document.body,a=void 0!==t.pageYOffset?t.pageYOffset:r.scrollTop;n=this.props.isReverse?a:this.calculateTopPosition(e)+(e.offsetHeight-a-window.innerHeight)}else n=this.props.isReverse?e.parentNode.scrollTop:e.scrollHeight-e.parentNode.scrollTop-e.parentNode.clientHeight;n<Number(this.props.threshold)&&(this.detachScrollListener(),"function"===typeof this.props.loadMore&&this.props.loadMore(this.pageLoaded+=1))}},{key:"calculateTopPosition",value:function(e){return e?e.offsetTop+this.calculateTopPosition(e.offsetParent):0}},{key:"render",value:function(){var e=this,t=this.props,n=t.children,r=t.element,a=t.hasMore,s=(t.initialLoad,t.isReverse),c=t.loader,i=(t.loadMore,t.pageStart,t.ref),u=(t.threshold,t.useCapture,t.useWindow,function(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}(t,["children","element","hasMore","initialLoad","isReverse","loader","loadMore","pageStart","ref","threshold","useCapture","useWindow"]));u.ref=function(t){e.scrollComponent=t,i&&i(t)};var l=[n];return a&&(c?s?l.unshift(c):l.push(c):this.defaultLoader&&(s?l.unshift(this.defaultLoader):l.push(this.defaultLoader))),o.default.createElement(r,u,l)}}]),t}();i.propTypes={children:s.default.oneOfType([s.default.object,s.default.array]).isRequired,element:s.default.string,hasMore:s.default.bool,initialLoad:s.default.bool,isReverse:s.default.bool,loader:s.default.object,loadMore:s.default.func.isRequired,pageStart:s.default.number,ref:s.default.func,threshold:s.default.number,useCapture:s.default.bool,useWindow:s.default.bool},i.defaultProps={element:"div",hasMore:!1,initialLoad:!0,pageStart:0,ref:null,threshold:250,useWindow:!0,isReverse:!1,useCapture:!1,loader:null},t.default=i,e.exports=t.default},920:function(e,t,n){var r=n(865);e.exports=function(e,t){return r(Date.now(),e,t)}},969:function(e,t,n){"use strict";n.r(t);var r=n(214),a=n(806),o=n.n(a),s=n(807),c=n(153),i=n(154),u=n(156),l=n(155),d=n(157),p=n(0),f=n.n(p),h=n(129),v=n(130),m=n(158),b=n(30),y=n(818),E=n.n(y),g=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.attendee;return f.a.createElement(h.p.Item,null,f.a.createElement(h.m,{as:b.b,to:"/profile/".concat(e.id),size:"mini",circular:!0,src:e.photoURL}))}}]),t}(p.Component),w=n(814),O=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.event;return f.a.createElement(h.t.Group,null,f.a.createElement(h.t,null,f.a.createElement(h.n.Group,null,f.a.createElement(h.n,null,f.a.createElement(h.n.Image,{size:"tiny",circular:!0,src:e.hostPhotoURL}),f.a.createElement(h.n.Content,null,f.a.createElement(h.n.Header,{as:b.b,to:"/event/".concat(e.id)},e.title),f.a.createElement(h.n.Description,null,"Hosted by"," ",f.a.createElement(b.b,{to:"/profile/".concat(e.hostUid)},e.hostedBy)),e.cancelled&&f.a.createElement(h.o,{style:{top:"-40px"},ribbon:"right",color:"red",content:"This event has been cancelled"}))))),f.a.createElement(h.t,null,f.a.createElement("span",null,f.a.createElement(h.l,{name:"clock"})," ",E()(e.date,"dddd Do MMMM")," at"," ",E()(e.date,"HH:mm")," |",f.a.createElement(h.l,{name:"marker"})," ",e.venue)),f.a.createElement(h.t,{secondary:!0},f.a.createElement(h.p,{horizontal:!0},e.attendees&&Object(w.c)(e.attendees).map(function(e){return f.a.createElement(g,{key:e.id,attendee:e})}))),f.a.createElement(h.t,{clearing:!0},f.a.createElement("span",null,e.description),f.a.createElement(h.a,{as:b.b,to:"/event/".concat(e.id),color:"teal",floated:"right",content:"View"})))}}]),t}(p.Component),j=n(918),x=n.n(j),L=function(e){function t(){return Object(c.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props,t=e.events,n=e.getNextEvents,r=e.loading,a=e.moreEvents;return f.a.createElement("div",null,t&&0!==t.length&&f.a.createElement(x.a,{pageStart:0,loadMore:n,hasMore:!r&&a,initialLoad:!1},t&&t.map(function(e){return f.a.createElement(O,{key:e.id,event:e})})))}}]),t}(p.Component),k=n(819),M=n(62),C=n(920),S=n.n(C),R=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).renderSummary=function(e){switch(e.type){case"newEvent":return f.a.createElement("div",null,"New Event!"," ",f.a.createElement(h.h.User,{as:b.b,to:{pathname:"/profile/"+e.hostUid}},e.hostedBy)," ","is hosting"," ",f.a.createElement(b.b,{to:{pathname:"/event/"+e.eventId}},e.title));case"cancelledEvent":return f.a.createElement("div",null,"Event Cancelled!"," ",f.a.createElement(h.h.User,{as:b.b,to:{pathname:"/profile/"+e.hostUid}},e.hostedBy)," ","has cancelled"," ",f.a.createElement(b.b,{to:{pathname:"/event/"+e.eventId}},e.title));default:return}},n}return Object(d.a)(t,e),Object(i.a)(t,[{key:"render",value:function(){var e=this.props.activity;return f.a.createElement(h.h.Event,null,f.a.createElement(h.h.Label,null,f.a.createElement("img",{src:e.photoURL||"/assets/user.png",alt:""})),f.a.createElement(h.h.Content,null,f.a.createElement(h.h.Summary,null,this.renderSummary(e)),f.a.createElement(h.h.Meta,null,f.a.createElement(h.h.Date,null,S()(e.timestamp)," ago"))))}}]),t}(p.Component),D=function(e){var t=e.activities,n=e.contextRef;return f.a.createElement(h.v,{context:n,offset:100},f.a.createElement(h.k,{attached:"top",content:"Recent Activity"}),f.a.createElement(h.t,{attached:!0},f.a.createElement(h.h,null,t&&t.map(function(e){return f.a.createElement(R,{key:e.id,activity:e})}))))},T={getEventsForDashboard:k.d},N=function(e){function t(){var e,n;Object(c.a)(this,t);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(a)))).state={moreEvents:!1,loadingInitial:!0,loadedEvents:[],contextRef:{}},n.getNextEvents=Object(s.a)(o.a.mark(function e(){var t,r,a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.props.events,r=t&&t[t.length-1],e.next=4,n.props.getEventsForDashboard(r);case 4:(a=e.sent)&&a.docs&&a.docs.length<=1&&n.setState({moreEvents:!1});case 6:case"end":return e.stop()}},e)})),n.handleContextRef=function(e){return n.setState({contextRef:e})},n}return Object(d.a)(t,e),Object(i.a)(t,[{key:"componentDidMount",value:function(){var e=Object(s.a)(o.a.mark(function e(){var t;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.props.getEventsForDashboard();case 2:(t=e.sent)&&t.docs&&t.docs.length>1&&this.setState({moreEvents:!0,loadingInitial:!1});case 4:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"componentWillReceiveProps",value:function(e){this.props.events!==e.events&&this.setState({loadedEvents:[].concat(Object(r.a)(this.state.loadedEvents),Object(r.a)(e.events))})}},{key:"render",value:function(){var e=this.props,t=e.loading,n=e.activities,r=this.state,a=r.moreEvents,o=r.loadedEvents;return this.state.loadingInitial?f.a.createElement(M.a,{inverted:!0}):f.a.createElement(h.j,null,f.a.createElement(h.j.Column,{width:10},f.a.createElement("div",{ref:this.handleContextRef},f.a.createElement(L,{loading:t,moreEvents:a,events:o,getNextEvents:this.getNextEvents}))),f.a.createElement(h.j.Column,{width:6},f.a.createElement(D,{activities:n,contextRef:this.state.contextRef})),f.a.createElement(h.j.Column,{width:10},f.a.createElement(h.q,{active:t})))}}]),t}(p.Component);t.default=Object(m.connect)(function(e){return{events:e.events,loading:e.async.loading,activities:e.firestore.ordered.activity}},T)(Object(v.firestoreConnect)([{collection:"activity",orderBy:["timestamp","desc"],limit:5}])(N))}}]);
//# sourceMappingURL=10.d45e10fb.chunk.js.map